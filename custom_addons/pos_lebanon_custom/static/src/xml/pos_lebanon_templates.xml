<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- ============================================================ -->
    <!-- 1. ProductScreen: Restructure layout to 3-column + footer    -->
    <!--    Left: OrderSummary + Numpad + Payment (untouched)          -->
    <!--    Center: Product Grid (remove CategorySelector from here)  -->
    <!--    Right: Vertical Category Sidebar + Utility Buttons        -->
    <!--    Bottom: Exchange Rate Footer Bar                           -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ProductScreen" t-inherit="point_of_sale.ProductScreen" t-inherit-mode="extension">

        <!-- Remove the original CategorySelector from the rightpane (center area) -->
        <xpath expr="//CategorySelector" position="replace"/>

        <!-- Inject the right sidebar + footer AFTER the rightpane closes -->
        <xpath expr="//div[hasclass('product-screen')]" position="inside">

            <!-- === RIGHT SIDEBAR: Categories + Utility Buttons === -->
            <div t-if="!ui.isSmall"
                 class="lbp-right-sidebar d-flex flex-column border-start bg-view">

                <!-- Category List -->
                <div class="lbp-categories-list overflow-y-auto flex-grow-1 py-2 px-2">
                    <t t-foreach="this.getLbpCategories()" t-as="categ" t-key="categ.id">
                        <button class="btn w-100 text-start mb-1 py-2 px-3 rounded-3 lbp-cat-btn"
                                t-att-class="{
                                    'btn-primary fw-bold': pos.selectedCategory and pos.selectedCategory.id === categ.id,
                                    'btn-light': !(pos.selectedCategory and pos.selectedCategory.id === categ.id)
                                }"
                                t-on-click="() => this.pos.setSelectedCategory(categ.id)">
                            <span t-esc="categ.name" class="fs-6"/>
                        </button>
                    </t>
                </div>

                <!-- Utility Buttons -->
                <div class="lbp-utility-buttons d-flex flex-column gap-2 p-2 border-top">
                    <button class="btn btn-outline-secondary rounded-3 py-2 lbp-util-btn fw-semibold">Gift Card</button>
                    <button class="btn btn-outline-secondary rounded-3 py-2 lbp-util-btn fw-semibold">Discount</button>
                    <button class="btn btn-outline-danger rounded-3 py-2 lbp-util-btn fw-semibold">Area</button>
                </div>
            </div>

            <!-- === FOOTER: Exchange Rate Bar === -->
            <div t-if="this.showLbpFooter()" 
                 class="lbp-footer-bar d-flex justify-content-between align-items-center px-3 py-2 border-top bg-view w-100">
                <span class="text-muted fs-6">
                    Active Exchange Rate: <strong t-esc="this.formattedLbpRate()"/> LBP/$
                </span>
                <span class="fs-5 fw-bold" t-if="currentOrder">
                    Total Paid/Remaining:
                    <t t-esc="total"/>
                    | <t t-esc="this.lbpTotal"/> LBP
                </span>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 2. OrderDisplay: Append LBP equivalents to Taxes + Total     -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.OrderDisplay" t-inherit="point_of_sale.OrderDisplay" t-inherit-mode="extension">

        <!-- LBP Taxes -->
        <xpath expr="//span[hasclass('tax')]" position="after">
            <span t-if="order.config_id.display_lbp_total"
                  class="lbp-tax-amount text-muted ms-1" style="font-size: 0.8rem;">
                | <t t-esc="this.formatLbpAmount(order.amountTaxes)"/> LBP
            </span>
        </xpath>

        <!-- LBP Total -->
        <xpath expr="//span[hasclass('total')]" position="after">
            <div t-if="order.config_id.display_lbp_total"
                 class="lbp-total-display text-muted" style="font-size: 0.85rem;">
                <t t-esc="this.formatLbpAmount(order.priceIncl)"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 3. Orderline: Append LBP subtotal after the line price       -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.Orderline" t-inherit="point_of_sale.Orderline" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('product-price')]" position="after">
            <div t-if="line.order_id.config_id.display_lbp_total and !line.combo_parent_id"
                 class="lbp-line-price text-muted text-end"
                 style="font-size: 0.7rem; line-height: 1.1;">
                <t t-esc="this.getLineLbp()"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 4. ProductCard: Add dual-pricing (USD + LBP) below name      -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ProductCard" t-inherit="point_of_sale.ProductCard" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('product-name')]" position="after">
            <div class="lbp-product-price w-100 lh-sm mt-auto">
                <span class="fw-semibold lbp-usd-price" t-esc="this.formattedUsdPrice"/>
                <span t-if="this.showLbpPrice"
                      class="d-block text-muted lbp-lbp-price"
                      t-esc="this.formattedLbpPrice"/>
            </div>
        </xpath>
    </t>

</templates>
