<?xml version="1.0" encoding="UTF-8"?>
<templates id="template" xml:space="preserve">

    <!-- ============================================================ -->
    <!-- 1. ProductScreen: LBP footer bar (light Odoo style)          -->
    <!-- NOTE: Numpad override REMOVED — was breaking CategorySelector-->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ProductScreen" t-inherit="point_of_sale.ProductScreen" t-inherit-mode="extension">

        <!-- Inject footer INSIDE the product-screen div, at the bottom -->
        <xpath expr="//div[hasclass('product-screen')]" position="inside">
            <div t-if="this.showLbpFooter()"
                 class="lbp-footer-bar d-flex justify-content-between align-items-center px-3 py-2 w-100">
                <span>
                    Rate: <span class="lbp-rate-badge"><t t-esc="this.formattedLbpRate()"/> LBP/$</span>
                </span>
                <span t-if="currentOrder">
                    Total: <strong t-esc="this.env.utils.formatCurrency(currentOrder.priceIncl)"/>
                    | <span class="lbp-total-lbp"><t t-esc="this.lbpTotal"/> LBP</span>
                </span>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 2. OrderDisplay: Append LBP equivalents to Taxes + Total     -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.OrderDisplay" t-inherit="point_of_sale.OrderDisplay" t-inherit-mode="extension">

        <!-- LBP Taxes -->
        <xpath expr="//span[hasclass('tax')]" position="after">
            <span t-if="order.config_id.display_lbp_total"
                  class="lbp-amount ms-1" style="font-size: 0.8rem;">
                | <t t-esc="this.formatLbpAmount(order.amountTaxes)"/> LBP
            </span>
        </xpath>

        <!-- LBP Total -->
        <xpath expr="//span[hasclass('total')]" position="after">
            <span t-if="order.config_id.display_lbp_total"
                 class="lbp-amount ms-1" style="font-size: 0.85rem;">
                | <t t-esc="this.formatLbpAmount(order.priceIncl)"/> LBP
            </span>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 3. Orderline: Append LBP subtotal on its own line            -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.Orderline" t-inherit="point_of_sale.Orderline" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('product-price')]" position="after">
            <div t-if="line.order_id.config_id.display_lbp_total and !line.combo_parent_id"
                 class="lbp-amount text-end"
                 style="font-size: 0.7rem; line-height: 1.1;">
                <t t-esc="this.getLineLbp()"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 4. ProductCard: Dual-pricing (USD + LBP) below name         -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ProductCard" t-inherit="point_of_sale.ProductCard" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('product-name')]" position="after">
             <div class="lbp-product-price w-100 lh-sm mt-1">
                <div class="fw-semibold" t-esc="this.formattedUsdPrice"/>
                <div t-if="this.showLbpPrice"
                      class="lbp-amount"
                      style="font-size: 0.78em;"
                      t-esc="this.formattedLbpPrice"/>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 5. PaymentScreen — LBP total due display                     -->
    <!-- Toggle button REMOVED — auto-conversion by method name       -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.PaymentScreenDue" t-inherit="point_of_sale.PaymentScreenDue" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('total')]" position="inside">
            <div t-if="this.showLbp"
                 class="lbp-amount text-center"
                 style="font-size: 0.35em; font-weight: 700;">
                <t t-esc="this.lbpTotalDue"/> LBP
            </div>
        </xpath>
    </t>

    <!-- Show LBP equivalent next to each payment method button -->
    <t t-name="pos_lebanon_custom.PaymentScreen" t-inherit="point_of_sale.PaymentScreen" t-inherit-mode="extension">
        <!-- Info bar: tells user that LBP methods auto-convert -->
        <xpath expr="//Numpad" position="before">
            <div t-if="this.showLbp and this.isLbpLineSelected"
                 class="alert alert-success p-2 mb-2 text-center"
                 style="font-size: 0.82rem;">
                <i class="fa fa-info-circle me-1"/>
                Entering LBP — amount will be converted at
                <strong><t t-esc="this.formattedLbpRate"/> LBP/$</strong>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 6. PaymentScreenStatus — LBP remaining / change             -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.PaymentScreenStatus" t-inherit="point_of_sale.PaymentScreenStatus" t-inherit-mode="extension">

        <!-- Append LBP display after the status section -->
        <xpath expr="//div[hasclass('payment-status-amount')]" position="after">
            <div t-if="this.showLbp"
                 class="lbp-amount text-center mt-1"
                 style="font-size: 0.7rem; font-weight: 600;">
                <t t-esc="this.formatLbpAmount(props.order.remainingDue or props.order.change or 0)"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 7. OrderReceipt — LBP on each line, total, change, rate      -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.OrderReceipt" t-inherit="point_of_sale.OrderReceipt" t-inherit-mode="extension">

        <!-- LBP total on its own line directly below the USD Total row -->
        <xpath expr="//div[hasclass('receipt-total')]" position="after">
            <div t-if="this.showLbp" class="lbp-receipt-total">
                <t t-esc="this.formatLbpAmount(order.priceIncl)"/> LBP
            </div>
        </xpath>

        <!-- LBP on change row -->
        <xpath expr="//div[hasclass('receipt-change')]" position="after">
            <div t-if="this.showLbp and order.showChange"
                 class="lbp-receipt-line">
                Change: <t t-esc="this.formatLbpAmount(order.change)"/> LBP
            </div>
        </xpath>

        <!-- LBP exchange rate at bottom of receipt -->
        <xpath expr="//div[hasclass('before-footer')]" position="before">
            <div t-if="this.showLbp" class="lbp-receipt-rate">
                Rate: 1 USD = <t t-esc="this.formatLbpAmount(1)"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 8. ReceiptScreen — WhatsApp button + LBP in banner           -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ReceiptScreen" t-inherit="point_of_sale.ReceiptScreen" t-inherit-mode="extension">

        <!-- LBP amount in the "Payment Successful" banner -->
        <xpath expr="//span[hasclass('edit-order-payment')]" position="before">
            <span t-if="this.showLbp"
                  class="lbp-amount" style="font-size: 0.8em;">
                | <t t-esc="this.lbpOrderAmount"/> LBP
            </span>
        </xpath>

        <!-- WhatsApp phone input + send button after email input -->
        <xpath expr="//input[hasclass('send-receipt-email-input')]/.." position="after">
            <div class="d-flex mt-2">
                <input type="tel"
                       class="send-receipt-whatsapp-input o_input position-relative p-3 border border-end-0 rounded-start-2 text-body"
                       placeholder="e.g. +961 71 123 456"
                       t-model="this.lbpState.whatsappPhone"/>
                <div>
                    <button t-att-style="`width: ${this.ui.isSmall ? '4rem' : '8rem'}`"
                            class="btn btn-success btn-lg lh-lg rounded-start-0 h-100"
                            t-att-disabled="!this.isValidWhatsApp"
                            t-on-click="() => this.sendViaWhatsApp()">
                        <i class="fa fa-whatsapp"/>
                    </button>
                </div>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 9. ClosePosPopup — LBP on closing register                   -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ClosePosPopup" t-inherit="point_of_sale.ClosePosPopup" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('total-orders')]" position="after">
            <div t-if="this.showLbp"
                 class="lbp-amount text-center px-3 pb-2" style="font-size: 0.85em;">
                Exchange Rate: 1 USD = <t t-esc="this.formatLbpAmount(1)"/> LBP
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 10. LoginScreen — Username/Password (Odoo native styling)    -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.LoginScreen" t-inherit="point_of_sale.LoginScreen" t-inherit-mode="extension">

        <xpath expr="//div[hasclass('login-body')]" position="replace">
            <div class="login-body login-form d-flex flex-column gap-3 m-auto" style="max-width: 400px; width: 100%;">
                <div class="text-center mb-3">
                    <h4>POS Login</h4>
                </div>
                <input type="text"
                       class="form-control form-control-lg rounded-3 p-3"
                       placeholder="Username"
                       t-model="this.loginState.username"
                       t-on-keydown="(ev) => this.onUsernameKeydown(ev)"
                       t-att-disabled="this.loginState.isLoading"/>
                <input type="password"
                       class="form-control form-control-lg rounded-3 p-3"
                       placeholder="Password"
                       t-model="this.loginState.password"
                       t-on-keydown="(ev) => this.onPasswordKeydown(ev)"
                       t-att-disabled="this.loginState.isLoading"/>
                <button class="btn btn-primary btn-lg py-3 rounded-3 fw-bold"
                        t-on-click="() => this.openRegister()"
                        t-att-disabled="this.loginState.isLoading">
                    <i t-if="this.loginState.isLoading" class="fa fa-spin fa-circle-o-notch me-2"/>
                    <i t-else="" class="fa fa-sign-in me-2"/>
                    <span t-if="this.loginState.isLoading">Logging in...</span>
                    <span t-else="">Open Register</span>
                </button>
            </div>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 11. ProductInfoPopup — LBP on price fields                   -->
    <!-- ============================================================ -->
    <t t-name="pos_lebanon_custom.ProductInfoPopup" t-inherit="point_of_sale.ProductInfoPopup" t-inherit-mode="extension">

        <!-- LBP after Price excl. Tax -->
        <xpath expr="//label[contains(text(),'Price excl. Tax')]/../span" position="after">
            <span t-if="this.showLbp" class="lbp-amount ms-1" style="font-size: 0.85em;">
                | <t t-esc="this.formatLbpAmount(props.info.productInfo.all_prices.price_without_tax)"/> LBP
            </span>
        </xpath>

        <!-- LBP after Price incl. Tax -->
        <xpath expr="//label[contains(text(),'Price incl. Tax')]/../span" position="after">
            <span t-if="this.showLbp" class="lbp-amount ms-1" style="font-size: 0.85em;">
                | <t t-esc="this.formatLbpAmount(props.info.productInfo.all_prices.price_with_tax)"/> LBP
            </span>
        </xpath>
    </t>


    <!-- ============================================================ -->
    <!-- 12. ProductConfiguratorPopup — LBP in title + price extras  -->
    <!-- Patch via JS: product_configurator_popup_patch.js            -->
    <!-- ============================================================ -->

</templates>
